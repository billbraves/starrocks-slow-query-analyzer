<<<<<<< HEAD
# StarRocks æ…¢ SQL åˆ†æžç³»ç»Ÿ

## ðŸŽ¯ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸º StarRocks æ•°æ®åº“è®¾è®¡çš„æ…¢ SQL åˆ†æžå’Œä¼˜åŒ–å·¥å…·ï¼Œé›†æˆåˆ° Claude Code çš„è‡ªå®šä¹‰ Skills ä¸­ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«ã€è¯Šæ–­å’Œä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼Œæä¾›æ€§èƒ½ä¼˜åŒ–å»ºè®®ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **æ…¢ SQL è‡ªåŠ¨æ”¶é›†** - ä»Ž StarRocks çš„æŸ¥è¯¢æ—¥å¿—ä¸­è‡ªåŠ¨æ”¶é›†æ…¢æŸ¥è¯¢
- **æ™ºèƒ½åˆ†æžè¯Šæ–­** - åˆ†æž SQL ç»“æž„ã€æ‰§è¡Œè®¡åˆ’ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- **ä¼˜åŒ–å»ºè®®ç”Ÿæˆ** - æä¾›é’ˆå¯¹æ€§çš„ä¼˜åŒ–å»ºè®®å’Œ SQL æ”¹å†™æ–¹æ¡ˆ
- **å¤šæ ¼å¼æŠ¥å‘Š** - æ”¯æŒ HTMLã€Markdownã€JSON ä¸‰ç§æŠ¥å‘Šæ ¼å¼
- **Claude Code é›†æˆ** - é€šè¿‡è‡ªå®šä¹‰ Skills æ·±åº¦é›†æˆåˆ° Claude Code

## ðŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- StarRocks 2.0+
- Claude Codeï¼ˆä½¿ç”¨è‡ªå®šä¹‰ Skills åŠŸèƒ½ï¼‰

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®æ•°æ®åº“è¿žæŽ¥

ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼š

```yaml
database:
  host: "127.0.0.1"
  port: 9030
  user: "root"
  password: ""
  database: "information_schema"

slow_query_threshold: 1.0  # æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆç§’ï¼‰
analysis_time_range: 24     # åˆ†æžæ—¶é—´èŒƒå›´ï¼ˆå°æ—¶ï¼‰
```

### 3. è¿è¡Œåˆ†æž

#### å‘½ä»¤è¡Œæ–¹å¼

```bash
# åˆ†æžè¿‡åŽ» 24 å°æ—¶çš„æ…¢æŸ¥è¯¢
python starrocks_slow_query_analyzer.py

# è‡ªå®šä¹‰æ—¶é—´èŒƒå›´å’Œé˜ˆå€¼
python starrocks_slow_query_analyzer.py --time-range 6 --threshold 0.5

# æŒ‡å®šæ•°æ®åº“å’ŒæŠ¥å‘Šæ ¼å¼
python starrocks_slow_query_analyzer.py --database my_db --format html
```

#### Python API æ–¹å¼

```python
from starrocks_slow_query_analyzer import StarRocksSlowQueryAnalyzer

# åˆ›å»ºåˆ†æžå™¨
analyzer = StarRocksSlowQueryAnalyzer('config.yaml')

# æ‰§è¡Œåˆ†æž
report_path = analyzer.analyze(
    time_range_hours=24,
    min_execution_time=1.0,
    database_filter='your_database'
)

print(f"æŠ¥å‘Šå·²ç”Ÿæˆ: {report_path}")
```

#### åœ¨ Claude Code ä¸­ä½¿ç”¨

é…ç½®è‡ªå®šä¹‰ Skills åŽï¼Œåœ¨ Claude Code ä¸­ç›´æŽ¥å¯¹è¯ï¼š

```
è¯·å¸®æˆ‘åˆ†æž StarRocks è¿‡åŽ» 24 å°æ—¶çš„æ…¢ SQL

è¯·è¯¦ç»†åˆ†æžä¸Žè¡¨ ordersã€users ç›¸å…³çš„æ…¢æŸ¥è¯¢

è¯·è¯Šæ–­è¿™ä¸ª SQL çš„æ€§èƒ½é—®é¢˜ï¼š
SELECT * FROM orders WHERE create_time > '2024-01-01'
```

## ðŸ“Š æŠ¥å‘Šç¤ºä¾‹

åˆ†æžå®ŒæˆåŽä¼šç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š

### ç»Ÿè®¡æ¦‚è§ˆ
- æ€»æ…¢æŸ¥è¯¢æ•°
- å¹³å‡/æœ€å¤§æ‰§è¡Œæ—¶é—´
- æ€»æ‰«æè¡Œæ•°
- ä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ

### æ…¢æŸ¥è¯¢è¯¦æƒ…
- Query ID å’Œ SQL æ–‡æœ¬
- æ€§èƒ½æŒ‡æ ‡ï¼ˆæ‰§è¡Œæ—¶é—´ã€æ‰«æè¡Œæ•°ã€å†…å­˜ä½¿ç”¨ç­‰ï¼‰
- å‘çŽ°çš„é—®é¢˜åˆ—è¡¨
- ä¼˜åŒ–å»ºè®®

### ä¼˜åŒ–å»ºè®®æ±‡æ€»
- æŒ‰ä¼˜å…ˆçº§æŽ’åºçš„å»ºè®®åˆ—è¡¨
- é¢„æœŸæ€§èƒ½æå‡
- å®žæ–½è¯´æ˜Ž

## ðŸ—ï¸ é¡¹ç›®ç»“æž„

```
.
â”œâ”€â”€ starrocks_connector.py          # æ•°æ®åº“è¿žæŽ¥å™¨
â”œâ”€â”€ slow_query_collector.py         # æ…¢ SQL æ”¶é›†å™¨
â”œâ”€â”€ query_analyzer.py               # SQL åˆ†æžå™¨
â”œâ”€â”€ optimization_suggester.py       # ä¼˜åŒ–å»ºè®®ç”Ÿæˆå™¨
â”œâ”€â”€ report_generator.py             # æŠ¥å‘Šç”Ÿæˆå™¨
â”œâ”€â”€ starrocks_slow_query_analyzer.py # ä¸»ç¨‹åº
â”œâ”€â”€ config.yaml                     # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt                # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ skills/
â”‚       â””â”€â”€ starrocks_slow_query_analysis.md  # Claude Code Skill é…ç½®
â””â”€â”€ README.md
```

## ðŸ”§ é…ç½®è¯´æ˜Ž

### config.yaml é…ç½®é¡¹

```yaml
# æ•°æ®åº“è¿žæŽ¥é…ç½®
database:
  host: "127.0.0.1"        # StarRocks FE åœ°å€
  port: 9030               # FE ç«¯å£
  user: "root"             # ç”¨æˆ·å
  password: ""             # å¯†ç 
  database: "information_schema"  # æ•°æ®åº“

# æ…¢æŸ¥è¯¢é˜ˆå€¼é…ç½®
slow_query_threshold: 1.0         # æ…¢æŸ¥è¯¢æœ€å°æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
very_slow_query_threshold: 5.0    # ä¸¥é‡æ…¢æŸ¥è¯¢é˜ˆå€¼
critical_query_threshold: 10.0    # ä¸¥é‡æ…¢æŸ¥è¯¢é˜ˆå€¼

# åˆ†æžæ—¶é—´èŒƒå›´
analysis_time_range: 24            # åˆ†æžæ—¶é—´èŒƒå›´ï¼ˆå°æ—¶ï¼‰

# è¾“å‡ºé…ç½®
output:
  report_dir: "./reports"          # æŠ¥å‘Šè¾“å‡ºç›®å½•
  report_format: "html"            # æŠ¥å‘Šæ ¼å¼
  include_query_plans: true        # æ˜¯å¦åŒ…å«æ‰§è¡Œè®¡åˆ’

# ä¼˜åŒ–å»ºè®®é…ç½®
optimization:
  max_scan_rows: 10000000          # æœ€å¤§æ‰«æè¡Œæ•°é˜ˆå€¼
  max_scan_bytes: 1073741824       # æœ€å¤§æ‰«æå­—èŠ‚æ•°ï¼ˆ1GBï¼‰
  suggest_indexes: true            # æ˜¯å¦å»ºè®®åˆ›å»ºç´¢å¼•
```

## ðŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. å®šæœŸå·¡æ£€

```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œåˆ†æž
0 2 * * * /path/to/python starrocks_slow_query_analyzer.py --time-range 24
```

### 2. é’ˆå¯¹æ€§åˆ†æž

```bash
# åˆ†æžç‰¹å®šæ•°æ®åº“
python starrocks_slow_query_analyzer.py --database analytics_db

# åˆ†æžåŒ…å«ç‰¹å®šè¡¨åçš„æŸ¥è¯¢
python starrocks_slow_query_analyzer.py --pattern "orders"

# åˆ†æžç‰¹å®šç”¨æˆ·çš„æŸ¥è¯¢
python starrocks_slow_query_analyzer.py --user "data_team"
```

### 3. åœ¨ Claude Code ä¸­æ™ºèƒ½äº¤äº’

```
# ç»¼åˆåˆ†æž
è¯·å¸®æˆ‘åˆ†æžè¿‡åŽ» 6 å°æ—¶çš„æ…¢ SQLï¼Œé‡ç‚¹å…³æ³¨æ‰§è¡Œæ—¶é—´è¶…è¿‡ 5 ç§’çš„æŸ¥è¯¢

# æ·±åº¦è¯Šæ–­
è¯·è¯¦ç»†åˆ†æžä»¥ä¸‹ SQL å¹¶æä¾›ä¼˜åŒ–æ–¹æ¡ˆï¼š
[ç²˜è´´ä½ çš„ SQL]

# æŒç»­ç›‘æŽ§
è¯·å¸®æˆ‘æŠŠæ…¢ SQL åˆ†æžåŠ å…¥åˆ°æ—¥å¸¸å·¡æ£€æµç¨‹ä¸­
```

## ðŸ“ˆ ä¼˜åŒ–å»ºè®®ç±»åž‹

ç³»ç»Ÿä¼šè¯†åˆ«å¹¶æä¾›ä»¥ä¸‹ç±»åž‹çš„ä¼˜åŒ–å»ºè®®ï¼š

### ç´¢å¼•ä¼˜åŒ–
- è¯†åˆ«ç¼ºå°‘ç´¢å¼•çš„æŸ¥è¯¢
- å»ºè®®åˆ›å»ºåˆé€‚çš„ç´¢å¼•
- ä¼˜åŒ–ç´¢å¼•ä½¿ç”¨ç­–ç•¥

### SQL ç»“æž„ä¼˜åŒ–
- é¿å… SELECT *
- ä¼˜åŒ– OR æ¡ä»¶
- æ”¹è¿› LIKE æŸ¥è¯¢
- ä¼˜åŒ–å­æŸ¥è¯¢

### æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- å‡å°‘æ‰«æè¡Œæ•°
- åˆ©ç”¨åˆ†åŒºè£å‰ª
- ä¼˜åŒ– JOIN æ“ä½œ
- ä¼˜åŒ–èšåˆæŸ¥è¯¢

### é…ç½®ä¼˜åŒ–
- å†…å­˜ä½¿ç”¨å»ºè®®
- æ‰§è¡Œå¼•æ“Žå‚æ•°è°ƒæ•´

## ðŸ› å¸¸è§é—®é¢˜

### 1. æ— æ³•è¿žæŽ¥åˆ° StarRocks

- æ£€æŸ¥ `config.yaml` ä¸­çš„è¿žæŽ¥é…ç½®
- ç¡®è®¤ FE æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥ç½‘ç»œè¿žé€šæ€§

### 2. æ²¡æœ‰æ…¢æŸ¥è¯¢æ•°æ®

- ç¡®è®¤ `query_log` åŠŸèƒ½æ˜¯å¦å¼€å¯
- æ£€æŸ¥æ—¶é—´èŒƒå›´è®¾ç½®æ˜¯å¦åˆç†
- ç¡®è®¤é˜ˆå€¼è®¾ç½®æ˜¯å¦è¿‡ä½Ž

### 3. åˆ†æžæŠ¥å‘Šä¸å®Œæ•´

- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶èŽ·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ç¡®è®¤æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
- æ£€æŸ¥æƒé™è®¾ç½®

## ðŸ“š æŠ€æœ¯æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Claude Code (è‡ªå®šä¹‰ Skills)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   StarRocksSlowQueryAnalyzer        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€â”€ StarRocksConnector             â”‚  æ•°æ®åº“è¿žæŽ¥
â”‚  â”œâ”€â”€ SlowQueryCollector             â”‚  æ…¢æŸ¥è¯¢æ”¶é›†
â”‚  â”œâ”€â”€ QueryAnalyzer                  â”‚  SQL åˆ†æž
â”‚  â”œâ”€â”€ OptimizationSuggester          â”‚  ä¼˜åŒ–å»ºè®®
â”‚  â””â”€â”€ ReportGenerator                â”‚  æŠ¥å‘Šç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   StarRocks (information_schema)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿Žæäº¤ Issue å’Œ Pull Requestï¼

## ðŸ“„ è®¸å¯è¯

MIT License

## ðŸ‘¥ ä½œè€…

å¤§æ•°æ®ç ”å‘å·¥ç¨‹å¸ˆ - ä¸“ä¸º StarRocks æ€§èƒ½ä¼˜åŒ–è®¾è®¡

## ðŸ™ è‡´è°¢

æ„Ÿè°¢ StarRocks ç¤¾åŒºå’Œ Claude Code å›¢é˜Ÿæä¾›çš„ä¼˜ç§€å·¥å…·ã€‚

=======
# starrocks-slow-query-analyzer
StarRocks æ…¢ SQL åˆ†æžå·¥å…·
>>>>>>> 42918893246ace5bdb8babd987c03ae7a9ec4997
